# 需求文档 (Requirements Document)

## Hajimi King Go v2.0 - 多平台API密钥发现系统需求文档

### 1. 项目概述

**项目名称**: Hajimi King Go v2.0  
**版本**: 2.0.0  
**项目类型**: API密钥发现和验证系统  
**开发语言**: Go 1.21+  
**目标**: 从GitHub代码中智能发现和验证多平台API密钥

### 2. 业务需求

#### 2.1 核心功能需求

**FR-001: 多平台支持**
- 支持Google Gemini API密钥发现和验证
- 支持OpenRouter API密钥发现和验证  
- 支持SiliconFlow API密钥发现和验证
- 支持未来扩展其他平台API密钥

**FR-002: 平台开关控制**
- 支持全局平台开关控制
- 支持单独平台启用/禁用
- 支持三种执行模式：全部执行、单平台执行、选中平台执行
- 支持通过环境变量配置平台开关

**FR-003: 智能密钥识别**
- 基于正则表达式的密钥模式匹配
- 上下文分析，过滤占位符和测试密钥
- 置信度评分系统
- 风险级别评估（高/中/低）

**FR-004: 高性能并发处理**
- Worker Pool模式并发处理
- 平台间并发执行
- 文件级并发处理
- 密钥验证并发处理

**FR-005: 多级缓存系统**
- L1: 内存缓存（LRU算法）
- L2: 文件缓存
- L3: Redis缓存（可选）
- 智能缓存策略和TTL管理

**FR-006: 增量扫描**
- 支持断点续传功能
- 基于文件SHA的去重机制
- 智能扫描频率调整
- 检查点自动保存

**FR-007: 外部服务同步**
- 支持向Gemini Balancer同步密钥
- 支持向GPT Load Balancer同步密钥
- 异步队列处理
- 批量发送优化

**FR-008: Web管理界面**
- 密钥列表展示和管理
- 实时统计信息
- 搜索和筛选功能
- JWT认证支持

#### 2.2 非功能性需求

**NFR-001: 性能要求**
- 支持并发处理多个平台
- 单平台处理速度提升3-5倍
- 内存使用优化30-50%
- 支持处理大规模代码库

**NFR-002: 可靠性要求**
- 系统可用性99.9%
- 支持优雅关闭和重启
- 错误恢复和重试机制
- 完整的日志记录

**NFR-003: 可扩展性要求**
- 支持新增平台扩展
- 支持水平扩展
- 模块化架构设计
- 配置驱动开发

**NFR-004: 安全性要求**
- 敏感信息加密存储
- API密钥安全传输
- 访问控制和认证
- 审计日志记录

### 3. 技术需求

#### 3.1 平台支持

| 平台 | API密钥格式 | 验证端点 | 优先级 |
|------|-------------|----------|--------|
| Gemini | AIzaSy[A-Za-z0-9\-_]{33} | generativelanguage.googleapis.com | 1 |
| OpenRouter | sk-or-[A-Za-z0-9]{32} | openrouter.ai/api/v1/chat/completions | 2 |
| SiliconFlow | sk-[A-Za-z0-9]{32} | api.siliconflow.cn/v1/chat/completions | 3 |

#### 3.2 配置需求

**环境变量配置**:
```bash
# 平台开关
PLATFORM_GLOBAL_ENABLED=true
PLATFORM_EXECUTION_MODE=all
PLATFORM_GEMINI_ENABLED=true
PLATFORM_OPENROUTER_ENABLED=false
PLATFORM_SILICONFLOW_ENABLED=false

# 缓存配置
CACHE_L1_MAX_SIZE=1000
CACHE_L1_TTL=5m
CACHE_L2_TTL=1h

# 并发配置
WORKER_POOL_SIZE=8
MAX_CONCURRENT_FILES=10
```

#### 3.3 数据存储需求

**文件结构**:
```
data/
├── keys_valid_gemini_20241201_143022.txt
├── keys_valid_openrouter_20241201_143022.txt
├── key_429_gemini_20241201_143022.txt
├── keys_valid_detail_gemini_20241201_143022.log
└── scanned_shas.txt
```

### 4. 用户故事

**US-001: 作为系统管理员**
- 我希望能够通过配置文件控制哪些平台启用
- 这样我可以根据业务需求灵活配置系统

**US-002: 作为安全研究员**
- 我希望系统能够智能识别和过滤测试密钥
- 这样我可以专注于真实有效的密钥

**US-003: 作为开发者**
- 我希望系统支持高并发处理
- 这样我可以快速处理大量代码库

**US-004: 作为运维人员**
- 我希望系统提供详细的性能指标
- 这样我可以监控和优化系统性能

### 5. 验收标准

**AC-001: 多平台支持**
- 系统能够同时处理Gemini、OpenRouter、SiliconFlow三个平台
- 每个平台有独立的配置和查询规则
- 新增平台只需实现接口即可

**AC-002: 平台开关**
- 通过环境变量可以控制平台启用/禁用
- 支持三种执行模式正常工作
- 配置变更无需重启系统

**AC-003: 智能识别**
- 能够过滤90%以上的占位符和测试密钥
- 密钥识别准确率达到95%以上
- 支持置信度评分和风险级别评估

**AC-004: 性能优化**
- 并发处理性能提升3-5倍
- 缓存命中率达到60%以上
- 内存使用优化30%以上

**AC-005: 系统稳定性**
- 系统连续运行24小时无故障
- 支持优雅关闭和重启
- 错误恢复时间小于30秒