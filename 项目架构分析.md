# Hajimi King Go - 项目架构分析

## 📋 项目概述

**Hajimi King Go** 是一个用Go语言开发的GitHub API密钥搜索和验证工具，用于从GitHub代码仓库中自动发现和验证Google Gemini API密钥。该项目是Python版本的重构版本，提供更好的性能和并发处理能力。

## 🏗️ 整体架构

### 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    Hajimi King Go                          │
├─────────────────────────────────────────────────────────────┤
│  Web Interface (index.html)                                │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  - 密钥管理面板                                        │ │
│  │  - 实时统计显示                                        │ │
│  │  - 搜索和筛选功能                                      │ │
│  │  - 密钥复制功能                                        │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  API Server (internal/api/)                                │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  - RESTful API接口                                     │ │
│  │  - JWT认证机制                                         │ │
│  │  - 密钥缓存管理                                        │ │
│  │  - 分页查询支持                                        │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  Core Engine (cmd/app/main.go)                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │  - 主循环控制                                          │ │
│  │  - 并发处理管理                                        │ │
│  │  - 信号处理                                            │ │
│  │  - 统计信息收集                                        │ │
│  └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  Service Layer                                              │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │ GitHub      │ File        │ Sync        │ Logger      │ │
│  │ Client      │ Manager     │ Utils       │ Service     │ │
│  │             │             │             │             │ │
│  │ - API调用   │ - 文件操作  │ - 外部同步  │ - 日志记录  │ │
│  │ - 代理支持  │ - 检查点    │ - 队列管理  │ - 格式化    │ │
│  │ - 重试机制  │ - 查询解析  │ - 批量发送  │ - 级别控制  │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  Data Layer                                                 │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │ Config      │ Models      │ Checkpoint  │ File        │ │
│  │ Management  │ Definition  │ System      │ Storage     │ │
│  │             │             │             │             │ │
│  │ - 环境变量  │ - 数据结构  │ - 断点续传  │ - 密钥文件  │ │
│  │ - 默认配置  │ - JSON序列化│ - 状态保存  │ - 日志文件  │ │
│  │ - 验证检查  │ - 类型安全  │ - 增量扫描  │ - 查询文件  │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 核心模块详解

### 1. 主程序模块 (cmd/app/main.go)
- **职责**: 应用程序入口点和主控制逻辑
- **核心功能**:
  - 初始化所有服务组件
  - 管理主循环和并发处理
  - 处理系统信号和优雅关闭
  - 协调各个模块之间的交互

### 2. 配置管理模块 (internal/config/)
- **职责**: 统一管理应用程序配置
- **核心功能**:
  - 环境变量加载和解析
  - 默认值设置和验证
  - 代理配置管理
  - 外部服务配置

### 3. GitHub客户端模块 (internal/github/)
- **职责**: 与GitHub API交互
- **核心功能**:
  - 代码搜索API调用
  - 文件内容获取
  - 代理支持和轮换
  - 重试机制和错误处理
  - Token轮换管理

### 4. 文件管理模块 (internal/filemanager/)
- **职责**: 文件系统操作和数据持久化
- **核心功能**:
  - 密钥文件保存和读取
  - 检查点系统管理
  - 查询文件解析
  - 目录结构管理

### 5. 同步工具模块 (internal/syncutils/)
- **职责**: 与外部服务同步密钥
- **核心功能**:
  - Gemini Balancer同步
  - GPT Load Balancer同步
  - 异步队列管理
  - 批量发送机制

### 6. API服务器模块 (internal/api/)
- **职责**: 提供Web API和前端界面
- **核心功能**:
  - RESTful API接口
  - JWT认证机制
  - 密钥数据缓存
  - 分页和搜索功能

### 7. 数据模型模块 (internal/models/)
- **职责**: 定义数据结构
- **核心功能**:
  - 检查点数据结构
  - GitHub API响应模型
  - 密钥信息模型
  - 统计信息模型

### 8. 日志模块 (internal/logger/)
- **职责**: 日志记录和管理
- **核心功能**:
  - 多级别日志输出
  - 格式化日志信息
  - 系统状态记录

## 🔄 数据流图

```
GitHub API → GitHub Client → 主程序 → 文件管理器 → 存储
    ↓              ↓           ↓         ↓
搜索结果 → 内容提取 → 密钥验证 → 结果保存 → 外部同步
    ↓              ↓           ↓         ↓
文件内容 → 正则匹配 → Gemini API → 分类存储 → 队列发送
```

## 🚀 性能优化特性

### 1. 并发处理
- 使用Go的goroutine实现高并发
- 批量处理密钥验证
- 异步外部服务同步

### 2. 内存管理
- 预编译正则表达式
- 连接池复用
- 缓存机制优化

### 3. 网络优化
- 代理轮换支持
- 请求重试机制
- 超时控制

### 4. 存储优化
- 增量扫描支持
- 检查点断点续传
- 文件分片存储

## 🔒 安全特性

### 1. 认证机制
- JWT Token认证
- 24小时自动登录
- 访问密钥保护

### 2. 数据保护
- 密钥去重处理
- 敏感信息过滤
- 安全日志记录

### 3. 访问控制
- API访问限制
- 代理访问支持
- 错误信息脱敏

## 📊 监控和统计

### 1. 实时统计
- 密钥发现数量
- 验证成功率
- 处理进度跟踪

### 2. 日志系统
- 详细操作日志
- 错误追踪记录
- 性能指标监控

### 3. 健康检查
- API服务状态
- 外部服务连接
- 系统资源监控

## 🛠️ 技术栈

- **语言**: Go 1.21+
- **Web框架**: 原生HTTP包
- **认证**: JWT (golang-jwt/jwt/v5)
- **AI集成**: Google Generative AI
- **代理支持**: HTTP/SOCKS5
- **前端**: 原生HTML/CSS/JavaScript
- **部署**: Docker支持

## 📈 扩展性设计

### 1. 模块化架构
- 清晰的模块边界
- 松耦合设计
- 易于扩展和维护

### 2. 配置驱动
- 环境变量配置
- 运行时参数调整
- 插件化支持

### 3. API设计
- RESTful接口
- 标准化响应格式
- 版本兼容性

这个架构设计确保了系统的高性能、可扩展性和可维护性，同时提供了丰富的功能和良好的用户体验。